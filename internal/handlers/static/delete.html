<!DOCTYPE html>
<html>
<head>
    <title>Delete Records</title>
    <link rel="stylesheet" href="/style.css">
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('deleteForm');
            const resultsDiv = document.getElementById('results');

            form.addEventListener('submit', async function(e) {
                e.preventDefault();

                const ledgerCode = document.getElementById('ledgerCode').value;

                // Show confirmation dialog
                if (!confirm(`Are you sure you want to delete all records with Ledger Code: ${ledgerCode}? This action cannot be undone.`)) {
                    return;
                }

                resultsDiv.innerHTML = 'Deleting...';
                resultsDiv.className = '';

                try {
                    const formData = new FormData(form);

                    const response = await fetch('/delete', {
                        method: 'POST',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: new URLSearchParams(formData)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        resultsDiv.className = 'success';
                        if (result.deleted_count > 0) {
                            resultsDiv.innerHTML = `<h3>Success!</h3><p>Deleted <strong>${result.deleted_count}</strong> record(s) with Ledger Code: <strong>${ledgerCode}</strong></p>`;
                        } else {
                            resultsDiv.className = 'info';
                            resultsDiv.innerHTML = `<h3>No Records Found</h3><p>No records found with Ledger Code: <strong>${ledgerCode}</strong></p>`;
                        }
                        form.reset();
                    } else {
                        const errorText = await response.text();
                        resultsDiv.className = 'error';
                        resultsDiv.textContent = `Error: ${errorText}`;
                    }
                } catch (error) {
                    console.error('Error:', error);
                    resultsDiv.className = 'error';
                    resultsDiv.textContent = 'An error occurred. Please try again.';
                }
            });
        });
    </script>
    <style>
        /* Basic styles for feedback messages */
        .info, .error, .success { padding: 10px; margin-top: 10px; border-radius: 4px; }
        .info { background-color: #d9edf7; color: #31708f; }
        .error { background-color: #f2dede; color: #a94442; }
        .success { background-color: #dff0d8; color: #3c763d; }
        .warning-text { color: #856404; background-color: #fff3cd; padding: 10px; border-radius: 4px; margin-bottom: 15px; }
        .delete-button { background-color: #dc3545; }
        .delete-button:hover { background-color: #c82333; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Delete Records by Ledger Code</h1>
        <p><a href="/">&larr; Back to Data Entry</a> | <a href="/inquiry-page">Go to Inquiry Page</a></p>

        <div class="warning-text">
            <strong>⚠️ Warning:</strong> This action will permanently delete all records matching the specified Ledger Code. This cannot be undone.
        </div>

        <form id="deleteForm">
            <div class="form-group">
                <label for="ledgerCode">Ledger Code to Delete:</label>
                <input type="text" id="ledgerCode" name="ledger_code" pattern="[0-9]+" title="Please enter a numeric ledger code" required>
            </div>
            <button type="submit" class="delete-button">Delete Records</button>
        </form>
        <div id="results"></div>
    </div>
</body>
</html>
